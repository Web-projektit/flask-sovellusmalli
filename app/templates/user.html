{% extends "base.html" %}

{% block title %}Flask-sovellus - {{ user.username }}{% endblock %}

{% block page_content %}
<div class="page-header">
    <h1>{{ user.username }}</h1>

    {% if kuva %}
    <img src="{{ url_for('main.img',filename=kuva) }}" class="profiilikuva">    
    {% endif %}

    {% if user.name or user.location %}
    <p>
        {% if user.name %}{{ user.name }}{% endif %}
        {% if user.location %}
            from <a href="http://maps.google.com/?q={{ user.location }}">{{ user.location }}</a>
        {% endif %}
    </p>
    {% endif %}
    {% if current_user.is_administrator() %}
    <p><a href="mailto:{{ user.email }}">{{ user.email }}</a></p>
    {% endif %}
    {% if user.about_me %}<p>{{ user.about_me }}</p>{% endif %}
    <p>Member since {{ moment(user.member_since).format('L') }}. Nähty viimeksi {{ moment(user.last_seen).fromNow() }}.</p>
    <p>
        {% if user == current_user %}
        <a class="btn btn-default" href="{{ url_for('.edit_profile_all') }}">Edit Profile</a>
        {% endif %}
        {% if current_user.is_administrator() %}
        <a class="btn btn-danger" href="{{ url_for('.edit_profile_admin', id=user.id) }}">Edit Profile [Admin]</a>
        {% endif %}
    </p>
    <a class="tee-henkilokortti" href="{{ url_for('main.pdf', email=False) }}">Näytä henkilökortti</a>
    <a class="tee-henkilokortti" href="#" onclick="fetchAndCopyLink(); return false;">Hae linkki henkilökorttiin</a>

</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
url = "{{ url_for('main.henkilokortti_token') }}" 
linkki = "{{ url_for('main.henkilokortti', _external=True) }}"    
const fetchAndCopyLink = () => {
fetch(url)  //Huom. user_id haetaan palvelin-sessiosta
.then(response => response.json())
.then(data => {
    token = data.token;
    const textarea = document.createElement('textarea');
    textarea.value = `${linkki}?token=${token}`;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    alert(`Linkki on kopioitu leikepöydälle.`);
    })
.catch(error => console.error('Virhe:', error));
}  
</script>
{% endblock %}